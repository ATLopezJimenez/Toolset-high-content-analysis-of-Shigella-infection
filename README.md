**TOOLSET TO ANALYSE SHIGELLA INFECTION BY HIGH CONTENT**

This repository holds ImageJ macros, python code and trained CNN models developped by Ana Teresa López Jiménez in Serge Mostowy's lab (London School of Hygiene and Tropical Medicine). They were used to identify and analyse SEPT7 recruitment to Shigella flexneri as presented in the preprint submitted for peer-review:

"High-content superresolution microscopy and deep learning assisted analysis reveals host and bacterial heterogeneity during Shigella infection". Ana T. López-Jiménez, Dominik Brokatzky, Kamla Pillay, Tyrese Williams, Gizem Özbaykal Güler and Serge Mostowy (2024)

Description of each individual item is here below.

1. **ImageJ macro: "Segmentation_bacteria_square_crop.ijm"**
     This macro segments rod shaped bacteria based on fluorescence, and saves a square crop around this segmentation (ROI) with additional channels and the segmented mask.
     This macro is to be used to generate images to train a CNN or to be classified by an already trained CNN.

2. **ImageJ macro: "Easy_tool_to_classify.ijm"**
     This macro sequentially displays the cropped ROIs obtained with the macro "Segmentation_bacteria_square_crop.ijm" (1).
     Then it asks for input from the user to sort the displayed image into different categories.
     This macro eases the process of annotation required to train a CNN. 
   
3. **ImageJ macro: "Processing_for_single_vs_clump_classification.ijm"**
     This macro generates 8-bit images (greyscale) to train a CNN or to be classified as single or clump by the trained CNN model "model_classification_single_vs_clump.hdf5" (9).
     This macro uses as input the ROIs generated by the ImageJ macro "Segmentation_bacteria_square_crops.ijm" (1).

4. **Python code: "Denoise_tool.py"**
     This Python code uses ROIs obtained with the ImageJ macro "Segmentation_bacteria_square_crop.ijm" described in (1).
     It denoises the channel of the protein of interest (in this case SEPT7) using band pass filtering.
     It generates a 32 bit image with 3 channels: the channel with the bacterial fluorescence, the channel with the recruited protein (denoised), and the channel with the bacterial mask.
   
5. **ImageJ macro: "Dataset_parameters.ijm"**
     This ImageJ macro uses image outputs from the Python code "Denoise_tool.py" (4).
     It returns dataset parameters that are required for normalisation, as required in "Normalise_tool.py" (6)
   
6. **Python code: "Normalise_tool.py"**
     This Python code uses image outputs from the Python code "Denoise_tool.py" (4) and requires the max value of the dataset after denoising. This max value can be obtained using the ImageJ macro "Dataset_parameters.ijm". (5)
     It normalises the fluorescence from the channel with the recruited protein of interest.
     It generates a RGB image with to train a CNN or to be classified as SEPT7+ or SEPT7- by the trained "model_classification_SEPT7_recruitment.hdf5".

7. **Colab notebook: "Training_of_CNN_to_classify_single_vs_clump.ipynb"**
     This Colab notebook was used to trained a CNN with the annotated dataset for singles and clumps and generate the "model_classification_single_vs_clump.hdf5" 
   
8. **Colab notebook: "Training_of_CNN_to_classify_SEPT7_recruitment.ipynb"**
     This Colab notebook was used to trained a CNN with the annotated dataset for SETP7+ and SEPT7- associated bacteria and generate the "model_classification_SEPT7_recruitment.hdf5" 

9. **Trained model: "model_classification_single_vs_clump.hdf5"**
     This is a trained model to classify isolated bacteria vs. bacteria in clumps (any rod shape bacteria).
     This model can be used as a pre-trained model to apply Transfer Learning to a novel CNN to classify bacteria with different shapes.

10. **Trained model: "model_classification_SEPT7positive_vs_negative.hdf5"**
     This is a trained model to classify SETP7+ vs. SETP7- associated S. flexneri (or any alternative rod shape bacteria).
     This model can be used as a pre-trained model to apply Transfer Learning to a novel CNN to classify different cytoskeletal components recruited to bacteria.

11. **Colab notebook: "Apply_model_to_classify_single_vs_clump_bacteria.ipynb"**
     This colab notebook enables the classification single vs. clump bacteria using the trained "model_classification_single_vs_clump.hdf5" (10).
     Input images to be used can be obtained with the ImageJ macro: "Segmentation_bacteria_square_crop.ijm" (1) and processed using the ImageJ macro: "Processing_for_single_vs_clump_classification.ijm" (3)
    
12. **Colab notebook: "Apply_model_to_classify_SETP7_recruitment.ipynb"**
     This colab notebook enables the classification single vs. clump bacteria using the trained "model_classification_SEPT7_recruitment.hdf5".
     Input images to be used can be obtained with the ImageJ macro: "Segmentation_bacteria_square_crop.ijm" (1) and processed using the Python code: "Denoise_tool.py" (4) and "Normalise_tool.py" (6).

13. **Python code: "Sorting_files_after_classification.py"**
     This python code sorts images obtained with ImageJ macro: "Segmentation_bacteria_square_crop.ijm" (1) in two different folders, depending on the .txt file containing the classifications results obtained with "Apply_model_to_classify_single_vs_clump.ipynb" (11) or "Apply_model_to_classify_SETP7_recruitment.ipynb" (12).
    
14. **ImageJ macro: "Bacteria_measurements.ijm"**
     This ImageJ macro measures diverse parameters on a fluorescent channel indicated by the user, within the defined bacterial mask.
     This ImageJ macro uses image outputs from the ImageJ macro "Segmentation_bacteria_square_crop.ijm" (1).
     The output is a .cvs file containing the measurements.
   


For further questions, please contact anat.lopezjimenez@gmail.com



![Figure_for_github](https://github.com/ATLopezJimenez/Toolset-high-content-analysis-of-Shigella-infection/assets/128931828/0dd8a739-1cf3-4847-9e38-f5a4b1c3897d)



